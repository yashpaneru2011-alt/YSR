<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Flappy Bird Working</title>
<style>
body{
margin:0;
background:#70c5ce;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
}

canvas{
background:linear-gradient(#70c5ce,#ffffff);
border:3px solid #333;
touch-action:none;
}
</style>
</head>
<body>

<canvas id="game" width="400" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const gravity = 0.5;
const jump = -8;
const pipeWidth = 60;

let pipeGap = 160;
let pipeSpeed = 3;
let level = 1;

let state = "start";
let bestScore = localStorage.getItem("best") || 0;

let bird = {
x: 80,
y: 250,
radius: 18,
velocity: 0,
rotation: 0
};

let pipes = [];
let frame = 0;
let score = 0;

function resetGame(){
bird.y = 250;
bird.velocity = 0;
bird.rotation = 0;
pipes = [];
score = 0;
frame = 0;
level = 1;
pipeSpeed = 3;
pipeGap = 160;
state = "playing";
}

function drawBird(){
ctx.save();
ctx.translate(bird.x, bird.y);
ctx.rotate(bird.rotation);

ctx.beginPath();
ctx.arc(0, 0, bird.radius, 0, Math.PI*2);
ctx.fillStyle="yellow";
ctx.fill();
ctx.stroke();

ctx.restore();
}

function drawPipes(){
ctx.fillStyle="green";
pipes.forEach(pipe=>{
ctx.fillRect(pipe.x,0,pipeWidth,pipe.top);
ctx.fillRect(pipe.x,pipe.top+pipeGap,pipeWidth,canvas.height);
});
}

function updatePipes(){
if(frame%80===0){
let topHeight=Math.random()*250+50;
pipes.push({x:canvas.width,top:topHeight,passed:false});
}

pipes.forEach(pipe=>{
pipe.x-=pipeSpeed;

if(!pipe.passed && pipe.x+pipeWidth<bird.x){
score++;
pipe.passed=true;

if(score%5===0){
level++;
pipeSpeed+=0.5;
pipeGap-=5;
}
}

if(
bird.x+bird.radius > pipe.x &&
bird.x-bird.radius < pipe.x+pipeWidth &&
(bird.y-bird.radius < pipe.top ||
bird.y+bird.radius > pipe.top+pipeGap)
){
state="gameover";
}
});

pipes=pipes.filter(pipe=>pipe.x+pipeWidth>0);
}

function updateBird(){
bird.velocity+=gravity;
bird.y+=bird.velocity;

if(bird.velocity<0){
bird.rotation=-0.3;
}else{
bird.rotation=Math.min(bird.rotation+0.03,0.6);
}

if(bird.y+bird.radius>canvas.height || bird.y-bird.radius<0){
state="gameover";
}
}

function drawUI(){
ctx.fillStyle="#000";
ctx.font="20px Arial";
ctx.fillText("Score: "+score,10,30);
ctx.fillText("Best: "+bestScore,10,55);
ctx.fillText("Level: "+level,10,80);
}

function drawStart(){
ctx.fillStyle="#000";
ctx.font="28px Arial";
ctx.fillText("Flappy Bird",110,250);
ctx.font="18px Arial";
ctx.fillText("Tap to Start",150,300);
}

function drawGameOver(){
ctx.fillStyle="#000";
ctx.font="32px Arial";
ctx.fillText("Game Over",110,250);
ctx.font="18px Arial";
ctx.fillText("Tap to Restart",130,300);
}

function gameLoop(){
ctx.clearRect(0,0,canvas.width,canvas.height);

if(state==="start"){
drawStart();
}
else if(state==="playing"){
updateBird();
updatePipes();
drawPipes();
drawBird();
drawUI();
frame++;
}
else if(state==="gameover"){
if(score>bestScore){
bestScore=score;
localStorage.setItem("best",bestScore);
}
drawGameOver();
drawUI();
}

requestAnimationFrame(gameLoop);
}

function flap(){
if(state==="start"){
resetGame();
}
else if(state==="playing"){
bird.velocity=jump;
}
else if(state==="gameover"){
state="start";
}
}

window.addEventListener("touchstart", function(e){
e.preventDefault();
flap();
}, {passive:false});

window.addEventListener("click", flap);

document.addEventListener("keydown", e=>{
if(e.code==="Space") flap();
});

gameLoop();
</script>

</body>
</html>
